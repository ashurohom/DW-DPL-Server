<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_fixed_asset_register_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <html>
                    <head>
                        <meta charset="utf-8"/>
                        <style>
                            body { font-family: Arial, sans-serif; font-size: 10px; margin: 20px; }
                            .header { text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #333; }
                            .header h2 { margin-bottom: 5px; color: #2c3e50; }
                            .header p { margin: 3px 0; color: #555; }
                            .company-info { text-align: left; margin-bottom: 15px; }
                            .company-info p { margin: 2px 0; }
                            table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 9px; }
                            th { background-color: #2c3e50; color: white; padding: 6px; text-align: left; border: 1px solid #ddd; font-weight: bold; }
                            td { padding: 4px; border: 1px solid #ddd; }
                            .text-right { text-align: right; }
                            .text-center { text-align: center; }
                            .text-left { text-align: left; }
                            .total-row { font-weight: bold; background-color: #e8f4f8; }
                            .category-header { background-color: #d9edf7; font-weight: bold; color: #31708f; }
                            .no-data { text-align: center; padding: 30px; color: #666; font-style: italic; }
                            .page-break { page-break-after: always; }
                            .summary-box { margin-top: 25px; padding: 15px; border: 1px solid #bce8f1; background-color: #d9edf7; border-radius: 5px; }
                            .summary-box h4 { margin-top: 0; color: #31708f; border-bottom: 1px solid #bce8f1; padding-bottom: 5px; }
                            .summary-stats { display: flex; flex-wrap: wrap; justify-content: space-between; }
                            .stat-item { flex: 0 0 48%; margin-bottom: 8px; }
                            .footer { margin-top: 30px; padding-top: 10px; border-top: 1px solid #ddd; text-align: center; color: #777; font-size: 8px; }
                            .currency { font-family: monospace; }
                            .positive { color: #27ae60; }
                            .warning { color: #e74c3c; }
                            .info { color: #3498db; }
                        </style>
                    </head>
                    <body>
                        

                        <!-- Report Header -->
                        <div class="header">
                            <h2>FIXED ASSET REGISTER</h2>
                            <p>Report Date: <strong><t t-esc="doc.date_as_of"/></strong></p>
                            
                            <p>Status: <strong>
                                <t t-if="doc.state == 'draft'">Draft</t>
                                <t t-if="doc.state == 'open'">Active</t>
                                <!-- <t t-if="doc.state == 'close'">Closed</t> -->
                                <t t-if="doc.state == 'all'">All Status</t>
                            </strong></p>
                            
                            <p>Generated By: <strong>Dreamwarez</strong></p>
                            <t t-set="today" t-value="datetime.datetime.now().strftime('%Y-%m-%d')"/>
                            <p>Generated On: <strong><t t-esc="today"/></strong></p>
                        </div>
                        <br></br>
                        <br></br>
                        <br></br>
                        <br></br>

                        <table>
                            <thead>
                                <tr>
                                    <th width="4%">#</th>
                                    <th width="8%">Asset Code</th>
                                    <th width="18%">Asset Name</th>
                                    <th width="10%">Category</th>
                                    <th width="8%" class="text-center">Acq. Date</th>
                                    <!-- <th width="8%" class="text-center">Age (Years)</th> -->
                                    <th width="10%" class="text-right">Original Value</th>
                                    <th width="10%" class="text-right">Accum. Depreciation</th>
                                    <th width="10%" class="text-right">Net Book Value</th>
                                    <th width="8%">Custodian</th>
                                    <th width="6%" class="text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- CHANGE: Use get_asset_lines() instead of _get_assets() -->
                                <t t-set="assets" t-value="doc.get_asset_lines()"/>
                                <t t-set="total_original" t-value="0"/>
                                <t t-set="total_dep" t-value="0"/>
                                <t t-set="total_nbv" t-value="0"/>
                                <t t-set="total_count" t-value="0"/>
                                <t t-set="current_category" t-value="False"/>
                                <t t-set="serial_no" t-value="1"/>
                                
                                <t t-if="not assets or (assets and len(assets) == 1 and assets[0].get('asset_code') == 'NO-ASSETS-FOUND')">
                                    <tr>
                                        <td colspan="12" class="no-data">
                                            <h4>No Assets Found</h4>
                                            <p>No assets match the selected criteria or no assets have been created in the system.</p>
                                            <p>Please create assets in: <strong>Accounting → Assets → Assets</strong></p>
                                        </td>
                                    </tr>
                                </t>
                                
                                <t t-if="assets and len(assets) > 0 and not (len(assets) == 1 and assets[0].get('asset_code') == 'NO-ASSETS-FOUND')">
                                    <t t-foreach="assets" t-as="asset">
                                        <!-- Check if category changed -->
                                        <t t-if="current_category != asset.get('category')">
                                            <t t-if="current_category">
                                                
                                                <tr class="total-row">
                                                    <td colspan="5" style="text-align: right; padding-right: 10px;">
                                                        <strong><t t-esc="current_category"/> Total:</strong>
                                                    </td>
                                                    <td class="text-right"><strong><t t-esc="'%.2f' % cat_original"/></strong></td>
                                                    <td class="text-right"><strong><t t-esc="'%.2f' % cat_dep"/></strong></td>
                                                    <td class="text-right"><strong><t t-esc="'%.2f' % cat_nbv"/></strong></td>
                                                    <td colspan="2"></td>
                                                </tr>
                                            </t>
                                            
                                            <tr class="category-header">
                                                <td colspan="12">
                                                    <strong>Category: <t t-esc="asset.get('category')"/></strong>
                                                    <span style="float: right;">
                                                        Type: <t t-esc="asset.get('asset_type', 'Purchase')"/>
                                                        | Method: <t t-esc="asset.get('depreciation_method', 'Linear')"/>
                                                        | Life: <t t-esc="'%.1f' % asset.get('useful_life', 0)"/> years
                                                    </span>
                                                </td>
                                            </tr>
                                            <t t-set="current_category" t-value="asset.get('category')"/>
                                            <t t-set="cat_original" t-value="0"/>
                                            <t t-set="cat_dep" t-value="0"/>
                                            <t t-set="cat_nbv" t-value="0"/>
                                        </t>
                                        
                                        <t t-set="original_val" t-value="float(asset.get('original_value', 0))"/>
                                        <t t-set="dep_val" t-value="float(asset.get('accumulated_dep', 0))"/>
                                        <t t-set="nbv_val" t-value="float(asset.get('net_book_value', 0))"/>
                                        
                                        <t t-set="total_original" t-value="total_original + original_val"/>
                                        <t t-set="total_dep" t-value="total_dep + dep_val"/>
                                        <t t-set="total_nbv" t-value="total_nbv + nbv_val"/>
                                        <t t-set="total_count" t-value="total_count + 1"/>
                                        
                                        <t t-set="cat_original" t-value="cat_original + original_val"/>
                                        <t t-set="cat_dep" t-value="cat_dep + dep_val"/>
                                        <t t-set="cat_nbv" t-value="cat_nbv + nbv_val"/>
                                        
                                        <tr>
                                            <td class="text-center"><t t-esc="serial_no"/></td>
                                            <td><t t-esc="asset.get('asset_code', '')"/></td>
                                            <td><t t-esc="asset.get('asset_name', '')"/></td>
                                            <td><t t-esc="asset.get('category', '')"/></td>
                                            <td class="text-center"><t t-esc="asset.get('acquisition_date', '')"/></td>
                                            <td class="text-right currency"><t t-esc="'%.2f' % original_val"/></td>
                                            <td class="text-right currency">
                                                <span t-att-class="'warning' if dep_val > 0 else ''">
                                                    <t t-esc="'%.2f' % dep_val"/>
                                                </span>
                                            </td>
                                            <td class="text-right currency">
                                                <span t-att-class="'positive' if nbv_val > 0 else ''">
                                                    <t t-esc="'%.2f' % nbv_val"/>
                                                </span>
                                            </td>
                                            <td><t t-esc="asset.get('custodian', '')"/></td>
                                            <td class="text-center">
                                                <span t-att-class="'positive' if asset.get('status') == 'Active' else 'warning'">
                                                    <t t-esc="asset.get('status', '')"/>
                                                </span>
                                            </td>
                                        </tr>
                                        
                                        <t t-set="serial_no" t-value="serial_no + 1"/>
                                    </t>
                                    
                                    <t t-if="current_category">
                                        <tr class="total-row">
                                            <td colspan="5" style="text-align: right; padding-right: 10px;">
                                                <strong><t t-esc="current_category"/> Total:</strong>
                                            </td>
                                            <td class="text-right"><strong><t t-esc="'%.2f' % cat_original"/></strong></td>
                                            <td class="text-right"><strong><t t-esc="'%.2f' % cat_dep"/></strong></td>
                                            <td class="text-right"><strong><t t-esc="'%.2f' % cat_nbv"/></strong></td>
                                            <td colspan="2"></td>
                                        </tr>
                                    </t>
                                    <tr class="total-row" style="background-color: #d4edda; border-top: 2px solid #155724;">
                                        <td colspan="5" style="text-align: right; padding-right: 10px; font-size: 10px;">
                                            <strong>GRAND TOTAL (<t t-esc="total_count"/> Assets):</strong>
                                        </td>
                                        <td class="text-right" style="font-size: 10px;"><strong><t t-esc="'%.2f' % total_original"/></strong></td>
                                        <td class="text-right" style="font-size: 10px;"><strong><t t-esc="'%.2f' % total_dep"/></strong></td>
                                        <td class="text-right" style="font-size: 10px;"><strong><t t-esc="'%.2f' % total_nbv"/></strong></td>
                                        <td colspan="2"></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <t t-if="assets and len(assets) > 0 and not (len(assets) == 1 and assets[0].get('asset_code') == 'NO-ASSETS-FOUND')">
                            <div class="summary-box">
                                <h4>Summary Statistics</h4>
                                <div class="summary-stats">
                                    <div class="stat-item">
                                        <strong>Total Assets:</strong> <t t-esc="total_count"/>
                                    </div>
                                    <div class="stat-item">
                                        <strong>Total Original Value:</strong> <t t-esc="'%.2f' % total_original"/>
                                    </div>
                                    <div class="stat-item">
                                        <strong>Total Accumulated Depreciation:</strong> <t t-esc="'%.2f' % total_dep"/>
                                    </div>
                                    <div class="stat-item">
                                        <strong>Total Net Book Value:</strong> <t t-esc="'%.2f' % total_nbv"/>
                                    </div>
                                    <div class="stat-item">
                                        <strong>Average Original Value:</strong> <t t-esc="'%.2f' % (total_original/total_count if total_count else 0)"/>
                                    </div>
                                    <div class="stat-item">
                                        <strong>Overall Depreciation Rate:</strong> 
                                        <t t-set="dep_rate" t-value="(total_dep/total_original*100) if total_original else 0"/>
                                        <span t-att-class="'warning' if dep_rate > 50 else 'info'">
                                            <t t-esc="'%.1f' % dep_rate"/>%
                                        </span>
                                    </div>
                                    <div class="stat-item">
                                        <strong>Book Value Ratio:</strong> 
                                        <t t-set="bv_ratio" t-value="(total_nbv/total_original*100) if total_original else 0"/>
                                        <span t-att-class="'positive' if bv_ratio > 50 else 'warning'">
                                            <t t-esc="'%.1f' % bv_ratio"/>%
                                        </span>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px;">
                                    <h5>Asset Status Distribution:</h5>
                                    <t t-set="status_count" t-value="{}"/>
                                    <t t-foreach="assets" t-as="a">
                                        <t t-if="a.get('asset_code') != 'NO-ASSETS-FOUND'">
                                            <t t-set="status" t-value="a.get('status', 'Unknown')"/>
                                            <t t-set="status_count" t-value="dict(status_count, **{status: status_count.get(status, 0) + 1})"/>
                                        </t>
                                    </t>

                                    <t t-set="status_list" t-value="list(status_count.items())"/>
                                    <t t-foreach="status_list" t-as="item">
                                        <span style="display: inline-block; margin-right: 15px;">
                                            <strong><t t-esc="item[0]"/>:</strong> <t t-esc="item[1]"/> (<t t-esc="'%.1f' % (item[1]/total_count*100 if total_count else 0)"/>%)
                                        </span>
                                    </t>
                                </div>
                            </div>
                        </t>

                        <div class="footer">
                            <!-- CHANGE: Replace odoo with Dreamwarez -->
                            <p>Fixed Asset Register Report | Generated by Dreamwarez | Page 1 of 1</p>
                            <p>This report is generated as of <t t-esc="doc.date_as_of"/> and includes all assets up to this date.</p>
                        </div>

                    </body>
                </html>
            </t>
        </t>
    </template>

    <record id="action_report_fixed_asset_register" model="ir.actions.report">
        <field name="name">Fixed Asset Register</field>
        <field name="model">fixed.asset.register.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">dw_customer_credit.report_fixed_asset_register_template</field>
        <field name="print_report_name">'Fixed Asset Register - {date}'</field>
        <field name="binding_model_id" eval="False"/>
        <field name="binding_type">report</field>
    </record>

</odoo>